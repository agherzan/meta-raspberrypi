From bb788ea39d9a13d849d90a53841b8ff4254099e7 Mon Sep 17 00:00:00 2001
From: John Cox <jc@kynesim.co.uk>
Date: Tue, 11 Jun 2024 16:58:24 +0100
Subject: [PATCH 14/41] configure.ac: Add Wayland single-pixel capability test



Upstream-Status: Inappropriate

RPI-Distro repo forks original vlc and applies patches

to enable raspiberry pi support.
---

 configure.ac | 9 +++++++++
 1 file changed, 9 insertions(+)

--- a/configure.ac
+++ b/configure.ac
@@ -3287,6 +3287,7 @@ AC_ARG_ENABLE(wayland,
   [AS_HELP_STRING([--enable-wayland], [Incomplete Wayland support (default disabled)])])
 have_wayland="no"
 have_wayland_egl="no"
+have_wayland_single_pixel_buffer="no"
 
 AS_IF([test "${enable_wayland}" = "yes"], [
   PKG_CHECK_MODULES([WAYLAND_CLIENT], [wayland-client >= 1.5.91], [
@@ -3294,6 +3295,13 @@ AS_IF([test "${enable_wayland}" = "yes"]
     PKG_CHECK_EXISTS([wayland-protocols >= 1.4], [
       WAYLAND_PROTOCOLS="$(${PKG_CONFIG} wayland-protocols --variable pkgdatadir)"
       AC_MSG_RESULT([${WAYLAND_PROTOCOLS}])
+      AC_MSG_CHECKING([for Wayland protocols single pixel buffer])
+      PKG_CHECK_EXISTS([wayland-protocols >= 1.26], [
+         AC_MSG_RESULT([yes])
+         have_wayland_single_pixel_buffer="yes"
+      ], [
+         AC_MSG_RESULT([no])
+      ])
     ], [
       AC_MSG_RESULT([not found])
       AC_MSG_ERROR([$(${PKG_CONFIG} --print-errors 'wayland-protocols >= 1.4')])
@@ -3327,6 +3335,7 @@ AC_SUBST([WAYLAND_PROTOCOLS])
 AC_SUBST([WAYLAND_SCANNER])
 AM_CONDITIONAL([HAVE_WAYLAND], [test "${have_wayland}" = "yes"])
 AM_CONDITIONAL([HAVE_WAYLAND_EGL], [test "${have_wayland_egl}" = "yes"])
+AM_CONDITIONAL([HAVE_WAYLAND_SINGLE_PIXEL_BUFFER], [test "${have_wayland_single_pixel_buffer}" = "yes"])
 
 
 dnl
